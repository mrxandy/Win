var Keeper={Base:null,Init:function(){Keeper.Base=Mo.Toolkit.getUrlBasic('js');Mo('head').create("link",{"rel":"stylesheet","type":"text/css","charset":"utf-8","href":Keeper.Base+"style/style.css?v=1.2"});},Dialog:{ Open:function(message,time){if(Mo("#keeper_dialog").size()==0){Mo(document.body).create('dl',{'id':'keeper_dialog','innerHTML':'<dt><button type="button" name="shut" class="shut">关闭</button><strong>帖子入库</strong></dt><dd></dd>','unselectable':'on'},true);Mo('#keeper_dialog button[name=hide]').bind('click',function(){Keeper.Dialog.Hide();});Mo('#keeper_dialog button[name=shut]').bind('click',function(){Keeper.Dialog.Remove();});Mo('#keeper_dialog button[name=note]').bind('click',function(){Mo('*[data-letter=note]').toggle();});}
var src=Mo.Toolkit.getScrollPosition();var vie=Mo.Toolkit.getViewportSize();Mo("#keeper_dialog dd").html(message);var div=Mo("#keeper_dialog").item(0);Mo("#keeper_dialog").style({'left':((vie.width-div.offsetWidth)/2)+'px','top':(src.top+((vie.height-div.offsetHeight)/2))+'px'});}, Hide:function(){Mo("#keeper_dialog").hide();}, Remove:function(){Mo("#keeper_dialog").remove();}},Login:function(app){Keeper.Dialog.Open('<p>抱歉，请先登录 App</p><p>访问：<a href="'+app+'" target="_blank">'+app+'</a></p>');},doLogin:function(){},Push:function(data){if(!data['subject']){Keeper.Dialog.Open('<p class="note">抱歉，帖子标题未能正常获取</p>');}else if(Mo.date("y-m-d",data['posttime'])!=Mo.date("y-m-d")){Keeper.Dialog.Open('<p class="note">抱歉，只能入库当天发的帖子</p>');}else{var msg='';for(var key in data){msg+='&data['+key+']='+encodeURIComponent(data[key]);};Keeper.Dialog.Open('<p>正在提交数据……</p>');Mo.json(Keeper.Base+'api.php?action=push'+msg+'&callback=?',{"charset":"utf-8"},function(data){if(data['today']&&data['month']){var html='';html+='<p>今日主题：<strong>'+data['today']['threads']+'</strong> 今日回帖：<strong>'+data['today']['replys']+'</strong></p>';html+='<p>本月主题：<strong>'+data['month']['threads']+'</strong> 本月回帖：<strong>'+data['month']['replys']+'</strong></p>';};switch(data['return']){case'applogin':Keeper.Dialog.Open('<p class="note">抱歉，请先登录 App</p><p>访问：<a href="'+data['apphost']+'" target="_blank">'+data['apphost']+'</a></p>');break;case'userlogin':Keeper.Dialog.Open('<p class="note">抱歉，请先登录论坛</p>');break;case'existing':Keeper.Dialog.Open('<p class="note">抱歉，帖子已经入库</p>'+html);break;case'succeed':Keeper.Dialog.Open('<p class="note">谢谢，帖子成功入库</p>'+html);break;}});}},doPush:function(){}};Keeper.Init();
