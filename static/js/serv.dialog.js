/*!
*	(C)2009-2013 VeryIDE
*	http://www.veryide.com/
*	Serv:操作窗口服务
*	$Id: serv.dialog.js 2014/01/06 Lay $
*/
;if(typeof Serv!="object"){var Serv={}}Serv.File={show:function(a){Mo.store.object=a;Serv.Upload.Show("_file_");Serv.Upload.Select("_file_")},call:function(a){Mo.store.object.value=a.value}};Serv.Message=function(b,a,c){b&&Mo.Message(a?a:"info","<div>"+b+"</div>",(c?c:3),{unique:"message",center:true})};Serv.Manager={date:{"时段":["01","02"],"分钟":["01","02"]},profile:function(a){new parent.Serv.Dialog("dialog","用户个人信息",'<iframe src="'+Mo.store.host+"module/member/member.profile.php?uid="+a+'" frameborder=0></iframe>',"850","70%",{remove:true,draged:true,create:true})},Init:function(){if(Mo("#naver").size()){Serv.Naver(location.href,Mo.$("naver"),true)}Mo(document).bind("click",function(a,b){if(top!=self){top.Mo("#link").hide();top.Mo("#collect").hide();top.Serv.Module.find(parent!=top?parent:self)}})},Loaded:function(event){Serv.SideMenu.Init();if(Mo(".table").size()){Mo(".table tr").each(function(){if(!this.getAttribute("data-face")){this.setAttribute("data-face",this.className)}}).bind("mousedown",function(index,e){var target=Mo.Event(e).target();var mark=this.getAttribute("data-mark");if(mark&&target.tagName=="TD"&&Mo("input[type=checkbox]",this).size()){var obj=Mo("input[type=checkbox]",this).event("click")}}).bind("dblclick",function(index,e){var edit=this.getAttribute("data-edit");if(!edit){return false}location.href=edit.replace("{self}",encodeURIComponent(location.href))});Mo(".table tr td input[type=checkbox]").bind("change",function(index,e){var tr=this.parentNode.parentNode;var face=tr.getAttribute("data-face");Mo(tr).attr({className:(this.checked?"choice":face)})});Mo(".table .thead td").each(function(){var prefix="extra";var based=location.href;var param={field:Mo.get(prefix+"[field]",based),order:Mo.get(prefix+"[order]",based)};var local={field:this.getAttribute("data-sort-field"),"default":this.getAttribute("data-sort-default"),orderby:this.getAttribute("data-sort-orderby"),screen:this.getAttribute("data-sort-screen"),query:this.getAttribute("data-sort-query"),label:(this.textContent||this.innerText)};if(!local.field){return}if(!param.field&&!param.order&&local["default"]&&local.orderby){var param={field:local.field,order:local.orderby,filling:true}}local.order=(param.order=="desc"?"asc":"desc");var redir=based;if(param.field&&param.order&&!param.filling){redir=redir.replace(prefix+"[field]="+param.field,prefix+"[field]="+local.field);if(local.field==param.field){redir=redir.replace(prefix+"[order]="+param.order,prefix+"[order]="+local.order)}}else{redir=(redir.indexOf("?")>-1?redir+"&":redir+"?")+prefix+"[field]="+local.field+"&"+prefix+"[order]="+local.order}Mo(this).bind("click",function(){location.href=redir}).attr({className:(local.field==param.field?"sort "+param.order:"sort")});if(local.screen){var screen=eval("("+local.screen+");");var wrap=Mo(this).create("ul",{className:"select"},true).hide();var param=local.query.replace(/\$field/,local.field).replace(/\$value/,"");Mo(wrap.item(0)).create("li",{innerHTML:'<a href="'+param+'" data-sort-all="true">全部</a>'});var selected=null;for(var k in screen){var param=local.query.replace(/\$field/,local.field).replace(/\$value/,k);if(based.indexOf(param)>-1&&this.firstChild.data){var label=selected=this.firstChild.data=Mo.String(screen[k]).stripTags().output()}else{var label=null}Mo(wrap.item(0)).create("li",{innerHTML:'<a href="'+param+'" class="'+(label?"active":"")+'">'+screen[k]+"</a>"})}if(!selected){Mo("ul li a[data-sort-all=true]",this).attr({className:"active"})}Mo(this).bind("mouseover",function(){wrap.show()}).bind("mouseout",function(){wrap.hide()})}})}Mo(".table .thead input[type=checkbox]").unbind("click").bind("click",function(index,e){Mo.Event(e).stop();Mo(".table tbody input[type=checkbox]").checked().event("change")});if(parent.parent.Mo.store.model=="classic"){Mo("a").each(function(){var hash=this.getAttribute("data-hash");var tget=this.getAttribute("target");if(hash&&tget!="_blank"){Mo(this).bind("click",function(){var url=this.href.replace(Mo.store.host,Mo.store.base);parent.parent.Serv.Interflow.setHash("V",url);parent.parent.Serv.Classic.Sidebar.find(url)})}})}Mo("a[target=_dialog]").bind("click",function(index,e){if(parent!=self){Mo.Event(e).stop();var title=this.title;var width=this.getAttribute("data-width");var height=this.getAttribute("data-height");parent.parent.Serv.Dialog("dialog",(title||"Dialog"),"<iframe src="+this.href+" frameborder=0></iframe>",(width||"90%"),(height||"60%"),{remove:true,draged:true,create:true})}else{this.target="_blank"}});var a="placeholder" in document.createElement("input"),d="placeholder" in document.createElement("textarea");Mo("form").each(function(){if(!a&&!d){var len=this.elements.length;for(var i=0;i<len;i++){var ele=this.elements[i];var des=ele.getAttribute("placeholder");if(!des){continue}(function(){var self=ele;var desc=des;if(!self.value){self.value=desc;self.className+=" placeholder"}self.onfocus=function(){if(this.value==desc){this.value="";this.className=this.className.replace(" placeholder","")}};self.onblur=function(){if(!this.value){this.value=desc;this.className+=" placeholder"}}})()}}if(this.getAttribute("method")=="post"){var submit=Mo("button[type=submit]",this);var iclass=submit.attr("className");this.onsubmit=function(){var result=Mo.ValidForm(this,function(x){Serv.Message(x,"wrong",3)},"desc");if(result){Serv.Message("正在执行操作，请稍后…","info",300);if(submit.size()&&Mo.Array(["forbid","cancel"]).indexOf(submit.attr("className"))>-1){return false}submit.attr({className:iclass=="submit"?"forbid":"cancel"})}else{submit.attr({className:iclass})}return result};this.onkeydown=function(){parent.parent.Serv.Interflow&&parent.parent.Serv.Interflow.setMode(true)}}});Mo("label").bind("click",function(index,e){var input=Mo("input",this).item(0);if(input){var type=input.getAttribute("type");var name=input.getAttribute("name");var data=this.getAttribute("data-class");if(type=="checkbox"||type=="radio"){input.checked?Mo(this).attr({className:data+" checked"}):Mo(this).attr({className:data});if(type=="radio"){Mo("input[name='"+name+"']").each(function(){if(this!==input){Mo(this).parent().attr({className:data})}})}}}}).each(function(index,e){var input=Mo("input",this).item(0);input&&this.setAttribute("data-class",this.className?this.className:"");if(input&&input.checked){Mo(this).attr({className:this.className+" checked"})}});Mo("tr.section").each(function(){var section=this;var parent=section.parentNode;var sibling=parent.nextSibling;while(sibling&&sibling.nodeType!=1){sibling=sibling.nextSibling}if(sibling&&sibling.tagName=="TBODY"){Mo(section).attr({className:"section pointer"}).bind("click",function(){Mo(sibling).toggle(0,function(show){if(show){Mo("a",section).attr({className:"spread"})}else{Mo("a",section).attr({className:"shrink"})}})});Mo("td",section).create("a",{className:"shrink"});Mo(sibling).hide()}});Mo("input.date").bind("click",function(){showCalendar(this,(this.getAttribute("data-format")||"y-mm-dd"))});Mo("input.time").bind("click",function(){Mo.Timer(this,this.value)});Mo("button.editor").bind("click",function(){var url=this.getAttribute("data-url");if(url.indexOf("?")>-1){url+="&"}else{url+="?"}url+="jump="+encodeURIComponent(location.href);location.href=url});Mo("button.normal").bind("click",function(){var btn=this;var url=btn.getAttribute("data-url");if(btn.className=="delete"){if(url.indexOf("?")>-1){url+="&"}else{url+="?"}url+="jump="+encodeURIComponent(location.href);location.href=url}else{btn.className="delete";window.setTimeout(function(){btn.className="normal"},5000)}});Mo("var").each(function(){var type=this.getAttribute("data-type");var text=this.innerHTML;var file=Mo.store.host+"static/image/";switch(type){case"tip":if(!text){return true}this.outerHTML='<a class="module_tip" ><img src="'+file+'question.gif" align="absmiddle" /><span>'+text+"</span></a>";break;case"url":text+=text.indexOf("?")>-1?"&":"?";text=text+"jump="+encodeURIComponent(location.href);this.outerHTML=' <a href="'+text+'">"+ text +"</a> ';break;case"file":var extra=text.split(".")[text.split(".").length-1];if(!text||Mo.Array(Serv.Upload.Format).indexOf(extra)==-1){this.outerHTML="<img src='"+file+"format/unknow.gif' title='未知文件:"+extra+"'  align='absmiddle' /> "}else{this.outerHTML="<a href='"+text+"' target='_blank'><img src='"+file+"format/"+extra+".gif' title='新窗口打开文件'  align='absmiddle' /></a> "}break;case"type":var extra=text.split(".")[text.split(".").length-1];if(!text||Mo.Array(Serv.Upload.Format).indexOf(extra)==-1){this.outerHTML="<img src='"+file+"format/unknow.gif' title='未知文件:"+extra+"'  align='absmiddle' /> "}else{if(this.getAttribute("data-link")){this.outerHTML="<a href='"+this.getAttribute("data-link")+"'><img src='"+file+"format/"+extra+".gif' title='"+extra+"格式'  align='absmiddle' /></a> "}else{this.outerHTML="<img src='"+file+"format/"+extra+".gif' title='"+extra.toUpperCase()+"格式'  align='absmiddle' /> "}}break}})}};Mo.reader(Serv.Manager.Init);Mo.Sort=function(d,a,e,g,c){var b=(c=="desc"?"asc":"desc");var f='<div class="'+(e==g?c:"")+'"><a href="'+d.replace("{ord}",b).replace("{key}",e)+'">'+a+"</a></div>";Mo.write(f)};Serv.Hello=function(){var e=new Date().getHours();var a=[6,12,14,18,24];var c=["清晨","上午","中午","下午","晚上"];var d=0;for(;e>=a[d++];){}return c[d-1]+"好！"};Serv.Week=function(){return new Date().toLocaleString()+" 星期"+"日一二三四五六".charAt(new Date().getDay())};Serv.Naver=function(d,f,h){var c=f.getElementsByTagName("A");var b=c.length;for(var e=0;e<b;e++){var a=c[e].getAttribute("rel");var g=Mo.url(d);if(d.indexOf(c[e].href)>-1||(a&&a.indexOf(g.file)>-1)){if(h){c[e].parentNode.className="active"}else{c[e].parentNode.className=""}continue}}};Serv.SideMenu={Post:function(){var d=Mo(".module_feedback textarea").value();if(d.length>20){var c={origin:"client",domain:location.host,model:(parent.parent.Mo.store.model||"window"),"product[appname]":Mo.store.appname,"product[version]":Mo.store.version,"product[build]":Mo.store.build,"product[licence]":Mo.store.licence,browser:navigator.userAgent,appid:Serv.SideMenu.Appid,charset:Serv.SideMenu.Charset,filename:location.href.replace(Mo.store.host,""),summary:d};var b="";for(var a in c){b+="&"+a+"="+encodeURIComponent(c[a])}Serv.Message("正在提交反馈……","info");Mo.script("http://www.veryide.com/api.php?action=service&execute=report&callback=Serv.SideMenu.Call"+b);Mo(".module_feedback *").disabled()}else{Serv.Message("请尽量填写详细描述","wrong")}},Call:function(a){Mo(".module_feedback *").enabled();switch(a["return"]){case"succeed":Serv.Message("谢谢您的反馈，我们已收到","success");Mo(".module_feedback *").value("");Mo(".module_feedback").style({display:"none"});break;case"param":Serv.Message("请确保各项参数不能为空","wrong");break}},Init:function(){if(/(admin\.login\.php|serve\.control\.php)/.test(location.href)||Serv.SideMenu.Hide){return}var b=new RegExp("/module/(.+?)/","gim").exec(location.href);Serv.SideMenu.Appid=b?b[1]:"";Serv.SideMenu.Title=document.title.replace(" - VeryIDE","");Serv.SideMenu.Charset=(document.characterSet||document.charset).toLowerCase();var a='';if(parent!=self){a+=''}a+='</ul>	<div class="handle"></div></div><dl class="module_feedback">	<dt>		<a class="y">关闭</a>		<strong>反馈我的建议</strong>	</dt>	<dd>		<p>帮助我们改进 VeryIDE，您将在此后获得更好的使用体验</p>		<p><textarea placeholder="填写对此页的任何想法" cols="60" rows="5"></textarea></p>		<p><a class="y" href="http://www.veryide.com/misc.php?action=report&domain='+encodeURIComponent(location.host)+'" title="查看提交过的反馈" target="_dialog">查看提交过的反馈 &raquo;</a><button type="button" name="Submit" class="submit">提交建议</button></p>	</dd></dl>';Mo(document.body).create("div",{},true).attr({outerHTML:a});Mo(".module_feedback dt .y").bind("click",function(c,d){Mo.Event(d).stop();Mo(".module_feedback").style({display:"none"})});Mo(".module_sidemenu .handle").bind("click",function(c,d){Mo.Event(d).stop();Mo(".module_sidemenu .submenu").style({display:"block"})});Mo(".module_sidemenu .submenu a").bind("click",function(d,f){Mo.Event(f).stop();switch(this.getAttribute("data-method")){case"feedback":Mo(".module_feedback").style({display:"block"});Mo(".module_feedback textarea").focus();Mo(".module_feedback button[type=button]").unbind("click").bind("click",Serv.SideMenu.Post);break;case"guide":var c="http://www.veryide.com/guide.php";window.open(Serv.SideMenu.Appid?c+"?appid="+Serv.SideMenu.Appid+"&title="+encodeURIComponent(Serv.SideMenu.Title)+"&build="+Mo.store.build+"&version="+Mo.store.version+"&charset="+Serv.SideMenu.Charset:c);break;case"window":window.open(location.href);break;case"refresh":location.reload();break}Mo(".module_sidemenu .submenu").style({display:"none"})});Mo(document).bind("click",function(){Mo(".module_sidemenu .submenu").style({display:"none"})})}};function detectCapsLock(d,b,c){var g=c||window.event;var h=g.target||g.srcElement;var f=g.keyCode||g.which;var a=g.shiftKey||(f==16)||false;if(((f>=65&&f<=90)&&!a)||((f>=97&&f<=122)&&a)){Mo.Message("wrong",'<div class="s"></div><div class="c">注意：Caps Lock 键已被按下</div><div class="e"></div>',3,{unique:"message",center:true})}else{Mo("#bubble").remove()}};