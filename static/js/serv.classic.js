/*
*	Copyright VeryIDE 2009-2013
*	http://www.veryide.com/
*	Serv 经典扩展框架
*	$Id: Serv.Classic.js 2013/10/14 $
*/
Mo.ready(function(){Serv.Classic.Init()});Serv.Classic={action:"ajax.php",editMode:false,frame:null,Sidebar:{toggle:function(a,b){if(a||Mo("#sidebar").style("display")!="none"){Mo("#sidebar").hide();Mo("#control").attr({className:"left"});Mo("#container").attr({className:"welt"});if(b){Mo.Cookie.set("__sidebar","false")}}else{Mo("#sidebar").show();Mo("#control").attr({className:""});Mo("#container").attr({className:""});if(b){Mo.Cookie.set("__sidebar","true")}}Serv.Classic.resize()},splay:function(d){var b,a,c;if(d.className.indexOf("active")>-1){b="none";a="";c="展开全部菜单"}else{b="block";a="active";c="收缩全部菜单"}d.title=c;d.className=a;Mo("#menu-link ul").style({display:b});Mo("#menu-link div").style({display:a})},change:function(b,a){Mo("#menu-link ul").hide();Mo("#menu-link div").style({display:""}).attr({className:""});if(b){Mo(b).toggle();a.scrollIntoView(true);if(a.className=="active"){a.className=""}else{a.className="active"}}},open:function(b,a){if(Serv.prefix.editMode){if(Serv.Interflow.setMode(!confirm("您的操作尚未结束，离开或刷新页将会放弃所作的操作。\n\n是否同意放弃保存操作？"))){return}}Serv.Classic.setBox(a);Serv.Interflow.setHash("V",a);Serv.Classic.Sidebar.find(a)},find:function(a){if(!Mo("#menu-link").size()){return false}Mo("#menu-link li").attr({className:""});var a=decodeURIComponent(a);Mo("#menu-link a").each(function(){if(this.getAttribute("href",2)==a){Mo(this).parent().attr({className:"active"});Mo(this).parent(2).show()}})}},setBox:function(a){Serv.Classic.frame.location.href=decodeURIComponent(a)},Init:function(){Mo("#control").bind("click",function(){Serv.Classic.Sidebar.toggle(null,true)});Mo("#bind_splay").bind("click",function(){Serv.Classic.Sidebar.splay(this)});Mo("#bind_start").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/admin.start.php")});Mo("#bind_attach").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/data.attach.php")});Mo("#bind_licence").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/system.licence.php")});Mo("#bind_admin").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/admin.list.php")});Mo("#bind_system").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/serve.control.php")});Mo("#bind_module").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/module.control.php")});Mo("#bind_avatar,#bind_account").unbind("click").bind("click",function(){Serv.Classic.Sidebar.open(this,"module/system/admin.edit.php?action=edit&id="+Mo.store.aid);return false});Mo("#bind_logout").unbind("mouseover");Mo("#header-search form").bind("submit",function(b,c){Mo.Event(c).stop();window.open("http://www.baidu.com/s?wd="+encodeURIComponent(Mo("#q").value())+"&&ie=utf-8")});Mo("#header-search input").bind("focus",function(){this.value=(this.defaultValue==this.value?"":this.value);this.className="active"});Mo("#header-search input").bind("blur",function(){this.value=(this.defaultValue!=this.value?this.value:this.defaultValue);this.className=""});Serv.Classic.frame=window.frames.column;Serv.Classic.Links.save();var a=Mo.get("V");var a=Mo.store.account?(a?a:"module/system/admin.start.php"):"source/dialog/blank.html";Serv.Classic.setBox(a);if(Mo("#menu-link").size()){Serv.Classic.Sidebar.change();Serv.Classic.Sidebar.find(a);Mo("#menu-link div").bind("click",function(b){Serv.Classic.Sidebar.change("#mod_"+this.getAttribute("data-appid"),this)});Mo("#menu-link ul a").bind("click",function(b,c){Mo.Event(c).stop();Serv.Classic.Sidebar.open(this,this.getAttribute("href",2),true)});Mo("#header-info").bind("mouseover",function(b,c){if(Mo("#sidebar").style("display")=="none"){Mo.Tips(this,c,"",Mo("#menu-link").html().replace(/style\s*=[^>]+/ig,""),"click",10,45,{unique:"collect"});Mo("#collect a").bind("click",function(d,f){Serv.Classic.Sidebar.open(this,this.getAttribute("href",2),true);Mo.Event(f).stop(2)})}});if(Mo.Cookie.get("__sidebar")=="false"){Serv.Classic.Sidebar.toggle(true,true)}}},resize:function(){var b=Mo.Toolkit.getViewportSize();Serv.prefix.top=Mo("#header").position().height-10;Serv.prefix.left=0;Serv.prefix.width=Mo.document.clientWidth;Serv.prefix.height=Math.abs(Mo.document.clientHeight-Mo("#header").position().height);Mo.store.login&&Mo.store.login.Center();var a=document.documentElement;var e=Mo.$("header");var d=Mo.$("sidebar");try{if(Mo.store.account){Mo("#menu-link").style({height:Math.abs(a.clientHeight-e.offsetHeight-18-Mo.$("menu-title").offsetHeight-Mo.$("sidebar-search").offsetHeight)+"px"})}else{Mo("#sidebar").style({height:Math.abs(a.clientHeight-e.offsetHeight-10)+"px"})}Mo("#container,#column").style({width:Math.abs(a.offsetWidth-d.offsetWidth)+"px",height:Math.abs(a.clientHeight-e.offsetHeight)+"px"})}catch(c){window.status=c.description}},Links:{save:function(){if(Mo("#header-links").size()){Mo.store.links=new Object();Mo.store.links.i=0;Mo.store.links.links=new Array();Mo("#header-links a").each(function(a){Mo.store.links.links[a]='<a href="'+this.href+'" title="'+this.title+'" target="_blank">'+this.innerHTML+"</a>"});Serv.Classic.Links.slice();window.setInterval(Serv.Classic.Links.slice,4000)}},slice:function(){var a=Mo.store.links.links;Mo("#header-links").html('<img src="image/ad.gif" /> '+a[Mo.store.links.i]);Mo.store.links.i++;if(Mo.store.links.i>=a.length){Mo.store.links.i=0}}}};Serv.resize=Serv.Classic.resize;