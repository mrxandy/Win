/*
*	(C)2009-2013 VeryIDE
*	Mo.js
*	author:
*			Wiki[MO]	gwikimo@gmail.com	
*			Lay 		veryide@qq.com
*	
*	#UI 扩展，包括页面消息、对话框、星级评分等#
*/
if(typeof Mo!="function"){var Mo={plugin:[]}}Mo.Dialog=function(e,g,f,d,a,c){this.config=c?c:{};this.id=(c.unique?c.unique:Mo.random(10));this.style=e;this.title=g;this.html=f;this.width=d;this.height=a;this.object=null;this.mode="";this.config.zindex=this.config.zindex?this.config.zindex:9999;var b=this;this.onRemove=function(){return true};this.onMinimize=function(){return true};this.onMaximize=function(){return true};this.onCreate=function(){};this.onDblclick=function(){};this.onDragStart=function(){};this.onDragEnd=function(){};this.Center=function(h){var k=Mo.Toolkit.getScrollPosition();var n=Mo.Toolkit.getViewportSize();var m=this.object;if(typeof h=="undefined"||h){if(this.width.toString().indexOf("%")>-1){this.width=n.width*(parseInt(this.width)/100)}if(this.height.toString().indexOf("%")>-1){this.height=n.height*(parseInt(this.height)/100)}this.width=this.width>n.width?n.width-100:this.width;this.height=this.height>n.height?n.height-100:this.height;if(this.width){m.style.width=this.width+"px"}if(this.height){m.style.height=this.height+"px"}}var l=Mo("#"+this.id).position();var j=k.top+((n.height-l.height)/2);var i=k.left+((n.width-l.width)/2);m.style.left=(i<0?0:i)+"px";m.style.top=(j<0?0:j)+"px";if(this.config.locked){Mo("#"+this.id+"-bg").style({height:(n.height+k.top)+"px",width:"100%"})}};this.Create=function(){if(Mo("#"+this.id).size()){Mo("#"+this.id).toggle();return true}if(this.config.locked&&!this.config.minimize){var j=Mo(document.body).create("div",{id:this.id+"-bg"},true);if(Mo.Browser.msie&&Mo.Browser.version<=6){j.style({background:"#666",filter:"alpha(opacity=20)"})}else{j.attr({className:this.style+"-bg"})}j.style({position:"absolute",zIndex:this.config.zindex,top:"0",left:"0"})}var i=Mo.create("dl",{id:this.id,className:this.style});i.setAttribute("data-dialog","dialog");this.object=i;var l=document.createElement("dt");var k=document.createElement("strong");k.innerHTML=this.title;l.appendChild(k);if(this.config.remove){var m=document.createElement("span");m.className="remove";l.appendChild(m);m.onclick=function(){b.Remove(this)};Mo(m).bind("mousedown",function(p,q){Mo.Event(q).stop()})}if(this.config.maximize){var o=document.createElement("span");o.className="maximize";l.appendChild(o);o.onclick=function(){b.Maximize(this)};Mo(o).bind("mousedown",function(p,q){Mo.Event(q).stop()})}if(this.config.minimize){var m=document.createElement("span");m.className="minimize";l.appendChild(m);m.onclick=function(){b.Minimize(this)};Mo(m).bind("mousedown",function(p,q){Mo.Event(q).stop()})}Mo(l).bind("dblclick",function(p,q){b.onDblclick(b.config.maximize?o:null)});i.appendChild(l);var h=Mo.create("dd",{id:this.id+"-dd",innerHTML:this.html});i.appendChild(h);if(this.config.wrapper){Mo(this.config.wrapper).append(i);Mo(i).attr({className:this.style||"wrapper"})}else{document.body.appendChild(i)}Mo(i).style({zIndex:(parseInt(this.config.zindex)+1)});b.Center();b.onCreate(b);if(this.config.draged&&typeof Mo.Drag=="function"){l.className="drag";var n=new Mo.Drag(l,i);if(Mo("iframe",h).size()){Mo(document.body).create("div",{id:this.id+"-fix"},true).style({position:"absolute",zIndex:this.config.zindex+9999,top:"0",left:"0",width:"100%",height:"100%"}).hide()}n.onStart=function(){if(b.config.opacity){this.style.filter="alpha(opacity=70)";this.style.opacity=0.7}b.onDragStart(b);Mo("#"+b.id+"-fix").show()};n.onEnd=function(p,q){if(b.config.opacity){this.style.filter="alpha(opacity=100)";this.style.opacity=1}b.onDragEnd(b);Mo("#"+b.id+"-fix").hide()}}};this.Remove=function(h){if(b.onRemove(b)){Mo("#"+b.id).remove();Mo("#"+b.id+"-bg").remove()}};this.Minimize=function(h){if(b.onMinimize(b)){Mo("#"+b.id).toggle()}};this.Maximize=function(h){if(b.onMaximize(h)){if(b.mode=="Maximize"){Mo(b.object).style({height:""});b.Center();b.mode="";h.className="maximize"}else{var i=Mo.Toolkit.getScrollPosition();var j=Mo.Toolkit.getViewportSize();Mo(b.object).style({width:"100%",height:j.height+"px",left:"-4px",top:(i.top-2)+"px"});b.mode="Maximize";h.className="toggle"}}};if(this.config.create){this.Create()}};Mo.Selector=function(d,c,e){var b=$E(d);if(typeof e!="function"){var e=function(h,f,g){if(h==f){g.className="active"}else{g.className=""}}}for(var a=0;a<b.length;a++){e(c,b[a].getAttribute("rel"),b[a])}};Mo.Planer=function(a){var a=a;this.getTable=function(d,e){var b=e?e:5;var c=d;while(b>0){c=c.parentNode;b--}return c};this.remove=function(c,d){if(this.getNodes(a)==1){alert("只剩下一个啦！");return}if(confirm("确定要删除掉这个吗？")){var b=this.getTable(c,d);Mo(b).remove()}};this.copy=function(c){var b=this.getLast(a).cloneNode(true);try{Mo("input,textrea",b).value("");Mo("*[data-remove=true]",b).remove()}catch(d){}a.appendChild(b);if(typeof c=="function"){c(b)}};this.move=function(f,b,g){var d=this.getTable(f,g);if(d.getAttribute("fixed")){return}if(b=="down"){var c=Mo(d).next();if(c==null){return false}else{if(!c||c.getAttribute("fixed")){return}d.swapNode(c)}}if(b=="up"){var e=Mo(d).prev();if(e==null){return false}else{if(!e||e.getAttribute("fixed")){return}d.swapNode(e)}}};this.getNodes=function(e){var b=e.childNodes;var d=0;for(var c=0;c<b.length;c++){if(b[c].nodeType==1){d++}}return d};this.getFirst=function(c){var b=c.firstChild;while(b&&b.nodeType!=1){b=b.nextSibling}return b};this.getLast=function(c){var b=c.lastChild;while(b&&b.nodeType!=1){b=b.previousSibling}return b}};Mo.Table=function(d,a){if(typeof d=="string"){d=$(d)}var e=d.getElementsByTagName("tr");for(var c=0;c<e.length;c++){var b=e[c];for(var f=0;f<a.length;f+=2){(function(){var h=a[f];var g=a[f+1];b["on"+h]=function(i){var i=i||event;g(this,i)}})()}}};Mo.Message=function(b,g,e,d,f){if(typeof f!="function"){var f=function(){}}var d=d?d:{};var c=(d.unique?d.unique:Mo.random(10));if(!g){return}Mo("#"+c).remove();Mo(document.body).create("div",{id:c,className:b,innerHTML:g});if(d.center){var a=Mo.Toolkit.getScrollPosition();var i=Mo.Toolkit.getViewportSize();var h=Mo("#"+c).position();Mo("#"+c).style({position:"absolute",left:(i.width-h.width)/2+"px",top:a.top+(i.height/2)-(h.height/2)+"px"})}window.setTimeout(function(){Mo("#"+c).hide();f(Mo("#"+c).item(0))},1000*e)};Mo.Tips=function(j,a,b,f,e,h,g,d){Mo.Event(a).stop();var d=d?d:{};var c=(d.unique?d.unique:Mo.random(10));Mo("#"+c).remove();Mo(document.body).create("div",{id:c,className:b});var i=Mo(j).position();h=h?h:0;g=g?g:0;Mo("#"+c).style({position:"absolute",left:i.left+h+"px",top:i.top+g+"px"}).bind("click",function(k,l){if(d.bubble){Mo.Event(l).stop()}}).html(f);Mo(document).bind(e?e:"mouseover",function(k,m){var l=Mo.Event(m).element();if(j!=l){Mo("#"+c).hide()}})};Mo.FadeBox=function(){this.Speed=10;this.Timer=2000;this.Alpha=100;this.iCounter=0;this.iCurrent=0;this.iClock=null;this.Images=new Array();this.Add=function(b){this.Images[this.iCounter]=b;this.iCounter++};var a=this;this.onChange=function(){};this.FadeIn=function(){var c=this.Images[this.iCurrent];var b="filter:alpha(opacity="+parseInt(this.Alpha++)+"); opacity:"+(this.Alpha++/100)+";";c.style.cssText=b;c.setAttribute("style",b);if(this.Alpha>=100){window.clearInterval(this.iClock);this.iClock=null;this.Play();this.onChange(this.iCurrent)}};this.FadeOut=function(){var c=this.Images[this.iCurrent];var b="filter:alpha(opacity="+parseInt(this.Alpha--)+"); opacity:"+(this.Alpha--/100)+";";c.style.cssText=b;c.setAttribute("style",b);if(this.Alpha<=-10){window.clearInterval(this.iClock);this.iClock=null;this.Images[this.iCurrent].style.display="none";if(this.iCurrent+1==this.Images.length){this.iCurrent=0}else{this.iCurrent++}var c=this.Images[this.iCurrent];var b="filter:alpha(opacity=1); opacity:0.01; display:;";c.style.cssText=b;c.setAttribute("style",b);this.iClock=setInterval(function(){a.FadeIn()},this.Speed)}};this.PlayNext=function(){this.iClock=setInterval(function(){a.FadeOut()},this.Speed)};this.Play=function(c){if(typeof(c)=="number"){for(var b=0;b<this.iCounter;b++){this.Images[b].style.display="none"}this.iCurrent=c;this.Images[c].style.display=""}setTimeout(function(){a.PlayNext()},this.Timer)}};Mo.TabMenu=function(a){this.Event=a;this.Cur=-1;this.Inter=null;this.Speed=0;this.Array=new Array();this.TClass=["",""];this.BClass=["",""];this.TabClass=function(b,c){this.TClass=[b,c]};this.BoxClass=function(b,c){this.BClass=[b,c]};this.Add=function(c,b){if(c&&b){this.Array[this.Array.length]=[c,b]}};this.onChange=function(){};this.Change=function(c){if(c>=this.Array.length){return false}for(var f=0;f<this.Array.length;f++){if(this.TClass[0]||this.TClass[1]){this.Array[f][0].className=this.TClass[1]}if(this.BClass[0]||this.BClass[1]){this.Array[f][1].className=this.BClass[1]}else{this.Array[f][1].style.display="none"}}var e=this.Array[c][0];if(this.TClass[0]||this.TClass[1]){e.className=this.TClass[0]}var d=this.Array[c][1];if(this.BClass[0]||this.BClass[1]){d.className=this.BClass[0]}else{d.style.display=""}if(this.Inter){var b=this;d.onmouseover=function(){clearInterval(b.Inter)};d.onmouseout=function(){b.Auto(b.Speed)}}this.Cur=c;this.onChange(c)};this.Play=function(c){var b=this;for(var e=0;e<this.Array.length;e++){var d=this.Array[e][0];(function(){var f=e;d["on"+b.Event]=function(){b.Change(f);clearInterval(b.Inter)};d.onmouseout=function(){b.Auto(b.Speed)}})()}if(c<=this.Array.length-1){this.Change(c)}else{this.Change(0)}};this.Auto=function(c){if(c){this.Speed=c;var b=this;this.Inter=window.setInterval(function(){if((b.Cur+1)<=b.Array.length-1){b.Cur++;b.Change(b.Cur)}else{b.Change(0)}},c)}}};Mo.Soler=function(q,a,n,b,h,e,l,k){if(typeof e!="function"){var e=function(){}}Mo.Event(a).stop();var c="_timer_";Mo("#"+c).remove();Mo(document.body).create("dl",{id:c,className:b});var m=Mo(q).position();l=l?l:0;k=k?k:0;Mo("#"+c).style({position:"absolute",left:m.left+l+"px",top:m.top+k+"px",zIndex:"99999"}).bind("click",function(i,r){Mo.Event(r).stop()});var f=n?n:Mo(q).attr("_value_");for(var p in h){var d=Mo.create("dt",{innerHTML:p});var o=Mo.create("dd");var j=Mo.create("ul");for(var g in h[p]){(function(){var r=h[p][g];var i=Mo.create("li",{innerHTML:r,className:(f==r?"active":"")});Mo(i).bind("click",function(s,t){e.call(q,r,q);Mo.Event(t).stop();Mo("#"+c).hide();Mo(q).attr({_value_:r})});Mo(j).append(i)})()}Mo(o).append(j);Mo("#"+c).append(d,o)}Mo(document).bind("click",function(i,s){var r=Mo.Event(s).element();if(q!=r){Mo("#"+c).hide()}})};Mo.plugin.push("ui");