/*
*	(C)2009-2013 VeryIDE
*	http://www.veryide.com/
*	Serv 前端服务框架
*	$Id: serv.js 2014/05/18 Lay $
*/
var func=function(){Serv.resize();var a=Serv.viewport();window.status="欢迎使用 VeryIDE，当前窗口尺寸："+a.width+" x "+a.height};Mo.reader(func);Mo(window).bind("resize",func).bind("orientationchange",func);Mo.reader(function(){if(Serv.END){Serv.setup();return}if(Mo.store.model=="modern"){var a=new FX("greet",{opacity:{from:1,to:0}},1,"easeOut",function(){Mo("#greet").hide()});a.start()}Mo("#wrapper").show();Serv.resize();Mo("a").bind("focus",function(){this.blur()});Serv.Init()});Mo.store.zIndex=999;Mo.store.desktop=false;Mo.store.module={};Mo.store.addons={};Mo.store.widget=[];Mo.store.collect=9;Mo.store.talk=null;var Serv={END:false,API:"serv.php",home:"http://www.veryide.com/",store:new Object(),prefix:{},viewport:function(){return Mo.Toolkit.getViewportSize()},setup:function(){var c=Serv.viewport();var d=Mo("#setup").position();var b=(c.height-d.height)/2;var a=(c.width-d.width)/2;Mo("#setup").style({marginTop:b+"px"});Serv.resize=function(){Serv.setup()}},resize:function(){if(Serv.END){return}var b=Serv.viewport();Serv.prefix.top=Mo("#header").position().height;Serv.prefix.left=0;Serv.prefix.width=b.width;Serv.prefix.height=Math.abs(b.height-Mo("#header").position().height-Mo("#footer").position().height);Mo("#container").style({height:Serv.prefix.height+Mo("#footer").position().height+"px"});var a=Math.abs(b.height-Mo("#footer").position().height);Mo("#footer").style({top:a+"px"});Mo("#footbg").style({top:a+"px"});if(Mo.store.login){Mo.store.login.Center(false)}else{Mo("*[data-dialog=dialog]").each(function(){var d=Mo(this).attr("data-appid");var c=Mo(this).attr("data-appname");var f=Mo(this).attr("data-mode");var e=Mo.md5(d+"_"+c);switch(f){case"toggle":Serv.Module.maximize(e);break;case"maximize":Serv.Module.minimize(e);break}})}},empty:function(){},Dialog:function(d,f,e,c,a,b){b.zindex=(function(){return Mo.store.zIndex+=1})();if(c.toString().indexOf("%")>-1){c=Serv.prefix.width*(parseInt(c)/100)}new Mo.Dialog(d,f,e,c,a,b)},Init:function(){Serv.System.login();Serv.Adsense.load();if(!Mo.store.account){return false}window.setInterval(Serv.Command.listener,1000);Mo("body").create("div",{id:"tip"},true).hide();Mo("body").create("div",{id:"tool"},true).hide();if(Mo.store.model=="modern"){Serv.Addons.module();Serv.Widget.reader();Serv.Session.query(1000*Mo.store.heartbeat);Mo("head").create("link",{id:"theme",type:"text/css",rel:"stylesheet"})}Mo("#addon").bind("click",function(a,b){var c=Mo("#bind_market").position();Mo("#collect").style({left:c.left+c.width-10+"px",top:c.top+70+"px"}).toggle();Mo.Event(b).stop()});Mo("#collect a,#collect a img").bind("click",function(){Mo("#collect").hide();return false});Mo(document).bind("click",function(){Mo("#link").hide();Mo("#collect").hide()});Mo("#bind_home").bind("mouseover",function(){Serv.Tip("官方网站",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.store.home=new Mo.Dialog("dialog","官方网站",'<iframe width="100%" height="500" src="http://www.veryide.com/?domain='+encodeURIComponent(location.host)+"&version="+Mo.store.version+'" frameborder="0"></iframe>',"90%","60%",{unique:"dialog_home",remove:true,draged:true,zindex:(function(){return Mo.store.zIndex++})()});Serv.store.home.onDrag=function(a){Mo(a.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Serv.store.home.Create();return false});Mo("#bind_desktop").bind("mouseover",function(){Serv.Tip("显示桌面",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.System.desktop()});Mo("#bind_help").bind("mouseover",function(){Serv.Tip("网站推荐",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(a,b){Mo("#link").toggle();Mo.Event(b).stop()});Mo("#bind_refresh").bind("mouseover",function(){Serv.Tip("刷新页面",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.System.refresh()});Mo("#bind_theme").bind("mouseover",function(){Serv.Tip("外观设置",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.System.theme();return false});Mo("#bind_custom").bind("mouseover",function(){Serv.Tip("偏好设置",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.store.custom=new Mo.Dialog("dialog","偏好设置",'<iframe width="100%" height="300" src="source/dialog/custom.php" frameborder="0"></iframe>',600,400,{unique:"dialog_custom",remove:true,draged:true,zindex:(function(){return Mo.store.zIndex++})()});Serv.store.custom.onDrag=function(a){Mo(a.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Serv.store.custom.Create();return false});Mo("#bind_logout").bind("mouseover",function(){Serv.Tip("退出登录",this)}).bind("mouseout",function(){Serv.Tip()}).bind("click",function(){Serv.System.logout()});if(Mo.store.model=="modern"){Mo("#bind_avatar").bind("click",function(){Serv.Module.open("system","用户中心","photos","admin.edit.php?action=edit&id="+Mo.store.aid);return false})}Mo("#bind_market").bind("click",function(){Serv.store.module=new Mo.Dialog("dialog","应用市场",'<iframe width="100%" height="400" src="source/dialog/module.php" frameborder="0"></iframe>',795,450,{unique:"dialog_market",remove:true,draged:true,zindex:(function(){return Mo.store.zIndex++})()});Serv.store.module.onDrag=function(a){Mo(a.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Serv.store.module.onCreate=function(a){var b=Mo("#module").position();Mo("#"+a.id).style({left:b.left+b.width+10+"px",top:b.top+5+"px"})};Serv.store.module.Create();return false}).show();Mo("#bind_tasks").bind("click",function(){Serv.store.tasks=new Mo.Dialog("dialog","查看任务",'<iframe width="100%" height="400" src="source/dialog/tasks.php" frameborder="0"></iframe>',600,400,{unique:"dialog_tasks",remove:true,draged:true,zindex:(function(){return Mo.store.zIndex++})()});Serv.store.tasks.onDrag=function(a){Mo(a.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Serv.store.tasks.Create();return false});if(Mo.store.model=="modern"){Mo(document.body).bind("mousedown",function(a,c){var b=Mo.Event(c).target();while(b=b.parentNode){if(b.tagName=="DL"&&b.getAttribute("data-dialog")=="dialog"){Mo(b).style({zIndex:(Mo.store.zIndex+=1)}).show();break}}Mo.Event(c).stop()});if(Mo.store.avatar){Serv.System.avatar(Mo.store.avatar,true)}if(Mo.store.theme){Serv.System.theme(Mo.store.theme,true)}}},Adsense:{load:function(){Mo.script(Serv.home+"api.php?action=adsense&execute=proxy&domain="+encodeURIComponent(location.host)+"&licence="+Mo.store.licence+"&version="+Mo.store.version+"&rnd="+Mo.date("y-m-d"));window._gaq=[];_gaq.push(["_setAccount","UA-279570-4"]);_gaq.push(["_setDomainName","none"]);_gaq.push(["_setAllowLinker",true]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})()},show:function(b,d){if(!Mo.store.account&&b=="banner"&&Mo.store.model=="modern"){Serv.Adsense.play(b,d)}if(Mo.store.account&&b!="banner"){if(b=="movie"&&Mo.Array(["full","only"]).indexOf(Mo.store.licence)==-1){Serv.Adsense.play(b,d)}if(b=="version"&&Mo.store.version){var c=d.name.match(/\[\d.*\]/);var a=c?parseFloat(c.toString().replace(/(\[|\])/g,"")):0;if(a>Mo.store.version){Serv.Adsense.play(b,d)}}}},play:function(a,b){if(new Date().getTime()>(b.expire*1000)){Mo.script(Serv.home+"api.php?action=adsense&execute=expire&id="+b.id+"&rnd="+Math.random())}var c='<a href="'+b.link+'" target="_blank">'+(b.file?'<img src="'+b.file+'" alt="'+b.name+'" />':b.name)+"</a><button onclick=\"Mo('#"+a+"').hide();\">关闭</button>";Mo(document.body).create("div",{id:a,innerHTML:c});Mo("#"+a+" button").hide();if(a!="banner"){window.setTimeout(function(){Mo("#"+a+" button").show()},20000)}}},Method:[],Extend:{added:function(b,a){if(typeof Serv.Method[b]!="function"){Serv.Method[b]=a}},call:function(a,b){if(typeof Serv.Method[a]!="function"){alert("未知方法："+a)}else{Serv.Method[a](b)}}},Session:{query:function(a){window.setInterval(function(){Mo.script(Serv.API+"?action=session&callback=Serv.Session.parse&time="+Mo.Date().time())},a)},parse:function(a){Mo("#bind_avatar").html('<img src="'+a.avatar+'" />')}},Widget:{added:function(h,d,i,c){if(i&&c){var e=decodeURIComponent(c.xml);var b=Mo.XML.parseXML(e);var f=Mo.XML.getJSON(b);delete c.xml;if(!Mo.store.widget[h]){Mo.store.widget[h]={}}Mo.store.widget[h][d]=c;Mo.store.widget[h][d]["config"]=f.widget;var g=f.widget;if(g.script&&g.script["#text"]){Mo.script(g.script["#text"],{charset:"utf-8"})}if(g.html["@attributes"]&&g.html["@attributes"]["target"]){Mo(g.html["@attributes"]["target"]).html(g.html["#cdata-section"],(g.html["@attributes"]["replace"]=="true"?false:true));return}var a=Mo("#widget").create("div",{id:c.appid+"_"+c.widget,className:"widget",innerHTML:g.html["#cdata-section"]},true).attr({appid:c.appid,widget:c.widget,widgetname:g.name["#text"]}).bind("mouseover",function(l,j,k){Serv.Widget.tool(k,this,c.appid,c.widget)}).bind("mouseout",function(l,j,k){Serv.Widget.tool(k,this)}).item(0);Serv.Widget.revise(a,c);Mo.resize(function(){if(a&&c){Serv.Widget.revise(a,c)}});if(g.html["@attributes"]&&g.html["@attributes"]["draggable"]!="true"){return}(function(j,k){var l=new Mo.Drag(j);l.onStart=function(m,o,n){Mo("#tool").hide()};l.onDrag=function(m,o,n){Mo("#tool").hide()};l.onEnd=function(m,q,p){var o=(Serv.prefix.width-m);var n=(Serv.prefix.height-q);k.x=m;k.y=q;k.fx=o;k.fy=n;Mo.script(Serv.API+"?action=widget&execute=saved&appid="+k.appid+"&widget="+k.widget+"&x="+m+"&y="+q+"&fx="+o+"&fy="+n+"&rnd="+Math.random());window.status="x: "+m+" y: "+q+" fx:"+o+" fy:"+n;Serv.Widget.tool(p,j,k.appid,k.widget)}})(a,c)}else{if(h){Mo.script(Serv.API+"?action=widget&execute=added&callback=Serv.Widget.added&appid="+h+"&widget="+d+"&rnd="+Math.random())}}},revise:function(b,e){switch(e.x){case"left":e.x="0";break;case"center":e.x=(Serv.prefix.width-b.offsetWidth)/2;break;case"right":e.x=(Serv.prefix.width-b.offsetWidth);break}switch(e.y){case"top":e.y="0";break;case"center":e.y=(Serv.prefix.height-b.offsetHeight)/2;break;case"bottom":e.y=(Serv.prefix.height-b.offsetHeight);break}var a=parseInt(e.x);var h=parseInt(e.y);var g=Math.min(e.x,e.fx);var f=Math.min(e.y,e.fy);var d=parseInt(e.fx);var c=parseInt(e.fy);switch(g){case a:b.style.left=(e.x?e.x:cfg.x)+"px";break;case d:b.style.left=(e.fx?(Serv.prefix.width-parseInt(e.fx)):cfg.x)+"px";break}switch(f){case h:b.style.top=(e.y?e.y:cfg.y)+"px";break;case c:b.style.top=(e.fy?(Mo.document.clientHeight-parseInt(e.fy)):cfg.y)+"px";break}b.style.zIndex=(e.z?e.z:0)},remove:function(b,c,a){if(a){Mo("*[data-appid="+b+"]").each(function(){if(Mo(this).attr("data-widget")==c){Mo(this).remove()}});Mo("#"+b+"_"+c).remove();delete Mo.store.widget[b][c]}else{if(b){Mo.script(Serv.API+"?action=widget&execute=remove&callback=Serv.Widget.remove&appid="+b+"&widget="+c+"&rnd="+Math.random())}}},front:function(b,c,a){if(Mo("#"+b+"_"+c).style("zIndex")==9999){var d=0}else{var d=9999}if(a){Mo("#"+b+"_"+c).style({zIndex:d})}else{if(b){Mo.script(Serv.API+"?action=widget&execute=front&callback=Serv.Widget.front&appid="+b+"&widget="+c+"&z="+d+"&rnd="+Math.random())}}},reader:function(a){if(a){Mo("#widget").html("");for(var b=0;b<a.length;b++){if(a[b]["xml"]){Serv.Widget.added(a[b]["appid"],a[b]["widget"],true,a[b])}}}else{Mo.script(Serv.API+"?action=widget&execute=reader&callback=Serv.Widget.reader&rnd="+Math.random())}},tool:function(d,a,b,c){if(b&&c){var g=Mo(a).position();Mo("#tool").style({left:(g.left+g.width-36)+"px",top:g.top+"px"});var f=' <span class="front" title="最前显示" onclick="Serv.Widget.front(\''+b+"','"+c+'\');"></span> <span class="close" title="删除 '+b+" - "+c+'" onclick="Serv.Widget.remove(\''+b+"','"+c+"');\"></span>";Mo("#tool").html(f).show();Mo("#tool").bind("mouseover",function(){Mo(this).show()}).bind("mouseout",function(){Mo(this).hide()}).bind("click",function(){Mo(this).hide()})}else{if(d&&(Mo.Event(d).element().tagName=="EMBED"||Mo.Event(d).element()==a)){Mo("#tool").hide()}}}},Addons:{added:function(a,b){if(b){Mo.store.addons.push(a);Serv.Addons.quick(a);Serv.Addons.collect()}else{Mo.script(Serv.API+"?action=addons&execute=added&callback=Serv.Addons.added&appid="+a+"&rnd="+Math.random())}},remove:function(b,c){if(c){Mo("#quick_"+b).remove();var a=Mo.Array(Mo.store.addons).indexOf(b);Mo.store.addons.splice(a,1);if(Mo.store.addons.length<=Mo.store.collect){Mo("#addon").attr({className:""}).html("")}if(Mo.store.addons.length>=Mo.store.collect){Serv.Addons.quick(Mo.store.addons[Mo.store.collect-1])}Serv.Addons.collect()}else{Mo.script(Serv.API+"?action=addons&execute=remove&callback=Serv.Addons.remove&appid="+b+"&rnd="+Math.random())}},collect:function(){var d=Mo.store.addons.length-Mo.store.collect;if(d>0){Mo("#collect").html("<ul></ul>");for(var c=Mo.store.collect;c<Mo.store.addons.length;c++){var e=Mo.store.addons[c];var a=Mo.store.module[e];if(!a){Serv.Addons.remove(e);return}Serv.Addons.serve(e);var b='<a href="javascript:void(0);" onclick="Serv.Module.open(\''+e+"','"+a.name+"','');return false;\"><img src=\"module/"+e+'/icon.png" /><br /><span>'+a.name+"</span></a>";Mo("#collect ul").create("li",{id:"quick_"+e,innerHTML:b})}Mo("#addon").html(Mo.store.addons.length-Mo.store.collect)}else{Mo("#collect").html("<p>没有更多快捷方式，请添加</p>")}},quick:function(d){var c=Mo("#quick li").size();if(c<Mo.store.collect+1){var a=Mo.store.module[d];if(!a){Serv.Addons.remove(d);return}Serv.Addons.serve(d);var e="quick_"+d;var b='<a href="javascript:void(0);" onclick="Serv.Module.open(\''+d+"','"+a.name+"','');return false;\"><img src=\"module/"+d+'/icon.png" /><br />'+a.name+"</a>";Mo("#quick").create("li",{id:e,innerHTML:b})}else{if(Mo.store.addons.length>Mo.store.collect){Mo("#addon").attr({className:"active"})}}},serve:function(b){var a=Mo.store.module[b];if(a&&a.serve){Mo.script("module/"+b+"/"+a.serve+"?rnd="+Math.random(),{charset:"utf-8"})}},reader:function(a){if(a){Mo.store.addons=a;Mo("#quick li").each(function(c){!this.getAttribute("reserve")&&Mo(this).remove()});for(var b=0;b<Mo.store.addons.length;b++){Serv.Addons.quick(Mo.store.addons[b])}Serv.Addons.collect();Serv.System.loading(true)}else{Serv.System.loading();Mo.script(Serv.API+"?action=addons&execute=reader&callback=Serv.Addons.reader&rnd="+Math.random())}},module:function(a){if(a){Mo.store.module=a;Serv.Addons.reader()}else{Mo.script(Serv.API+"?action=addons&execute=module&callback=Serv.Addons.module&rnd="+Math.random())}},saved:function(a){if(a){Mo.script(Serv.API+"?action=addons&execute=order&data="+a.join(",")+"&callback=Serv.Addons.reader&rnd="+Math.random())}}},System:{refresh:function(){location.reload()},loading:function(a){a?Mo("#loading").hide():Mo("#loading").show()},login:function(){if(!Mo.store.account){Mo.store.login=new Mo.Dialog("dialog","用户登录",'<iframe src="module/system/admin.login.php" frameborder="0"></iframe>',455,240,{unique:"dialog_login",locked:true,draged:true});Mo.store.login.Create();Mo("#dialog_login").style({zIndex:10001})}},logout:function(a){if(a){location.reload()}else{if(confirm("现在要退出登录吗？")){Mo.script(Serv.API+"?action=logout&callback=Serv.System.logout&rnd="+Math.random())}}},theme:function(b,a){if(b){Mo("#style").remove();Mo("#theme").attr({href:"static/theme/"+b+"/style.css"});Mo.store.theme=b;if(!a){Mo.script(Serv.API+"?action=theme&theme="+b+"&rnd="+Math.random())}}else{Mo.store._theme=new Mo.Dialog("dialog","设置外观",'<iframe src="source/dialog/theme.php?theme='+Mo.store.theme+'" frameborder="0"></iframe>',564,400,{unique:"dialog_theme",remove:true,draged:true,zindex:(function(){return Mo.store.zIndex++})()});Mo.store._theme.onDrag=function(c){Mo(c.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Mo.store._theme.Create()}},avatar:function(a,b){if(a){Mo("#bind_avatar").html('<img src="'+a+'" />');Mo.store.avatar=a;if(!b){Mo.script(Serv.API+"?action=avatar&avatar="+a+"&rnd="+Math.random())}}else{Mo.store._avatar=new Mo.Dialog("dialog","设置头像",'<iframe src="source/dialog/avatar.php?avatar='+Mo.store.avatar+'" frameborder="0"></iframe>',430,340,{unique:"dialog_avatar",remove:true,zindex:(function(){return Mo.store.zIndex++})()});Mo.store._avatar.onDrag=function(c){Mo(c.object).style({zIndex:(Mo.store.zIndex+=1)});return false};Mo.store._avatar.Create()}},desktop:function(){var a=false;Mo("#task li").each(function(){var b=this.id.replace("task_","");if(Mo.store.desktop){if(Mo("#talk_"+b).attr("data-show")!="false"){Mo("#talk_"+b).show()}}else{Mo("#talk_"+b).hide();a=true}});Mo("#menu").hide();if(!a){Mo.store.desktop=true}Mo.store.desktop=Mo.store.desktop?false:true}},Module:{open:function(e,a,c,d,b){var d="module/"+e+"/"+(d?d:"");var c=c?"static/image/extra/"+c+".png":"module/"+e+"/icon.png";var g=Mo.md5(e+"_"+a);if(Mo("#talk_"+g).size()){if(Mo.$("talk_"+g).getAttribute("data-link")!=d){Mo("#view_"+g).attr({src:d});Mo("#talk_"+g).attr({"data-link":d})}if(Mo.$("talk_"+g).getAttribute("data-icon")!=c){Mo("#icon_"+g).attr({src:c});Mo("#talk_"+g).attr({"data-icon":c})}Serv.Module.show(g);return true}var f=new Mo.Dialog("window",a,'<iframe id="view_'+g+'" data-appid="'+e+'" src="'+d+'" frameborder="0" scrolling="auto"></iframe>',390,0,{draged:true,minimize:(Mo.store.model=="modern"),maximize:true,remove:true,zindex:(Mo.store.zIndex++),unique:"talk_"+g});f.onMinimize=function(){Serv.Module.hide(g);return false};f.onRemove=function(){Serv.Module.close(g);return false};f.onMaximize=function(h){if(f.mode=="Maximize"){Serv.Module.minimize(g);f.mode="";h.className="maximize"}else{Serv.Module.maximize(g);f.mode="Maximize";h.className="toggle"}Mo("#talk_"+g).attr({"data-mode":h.className});return false};f.onDblclick=function(h){f.onMaximize(h);return false};f.onDragStart=function(h){return false};f.onDragEnd=function(h){return false};f.Create();if(b){dl.style.top=Serv.prefix.top+5+"px";dl.style.left=(Mo.document.clientWidth-b[0])/2+"px";dl.style.width=b[0];dl.style.height=b[1]}else{Serv.Module.minimize(g)}Mo.store.talk=g;Mo("#talk_"+g).attr({"data-show":"true","data-appid":e,"data-appname":a,"data-link":d,"data-mode":"maximize"});Mo("#task").create("li",{id:"task_"+g,innerHTML:'<a href="javascript:void(0);" onclick="Serv.Module.show(\''+g+'\');"><img id="icon_'+g+'" src="'+c+'" /></a>'},true).attr({"data-appid":e,"data-appname":a}).bind("mouseover",function(){Serv.Tip(a,this)}).bind("mouseout",function(){Serv.Tip()});return false},close:function(a){Mo("#talk_"+a).remove();Mo("#task_"+a).remove()},show:function(c,a){Mo("#talk_"+c).style({zIndex:(Mo.store.zIndex+=1)}).show();if(!a&&Mo("#talk_"+c).attr("data-show")=="true"&&Mo.store.talk==c){Serv.Module.hide(c);return}if(Mo("#talk_"+c).attr("data-show")=="false"){var b=new FX("talk_"+c,{left:{to:Serv.prefix.left+5},top:{to:Serv.prefix.top+5},width:{to:Serv.prefix.width-22},height:{to:Serv.prefix.height-52}},0.4);b.start()}Mo.store.talk=c;Mo("#talk_"+c).attr({"data-show":"true"})},hide:function(b){var c=Mo("#task_"+b).position();var a=new FX("talk_"+b,{left:{to:c.left},top:{to:c.top+50},width:{to:0},height:{to:0}},0.4,"easeOut",function(){Mo("#talk_"+b).hide()});a.start();Mo.store.talk=null;Mo("#talk_"+b).attr({"data-show":"false"})},minimize:function(a){Mo("#talk_"+a).style({top:Serv.prefix.top+5+"px",left:Serv.prefix.left+5+"px",width:Serv.prefix.width-22+"px",height:Serv.prefix.height-52+"px"})},maximize:function(a){Mo("#talk_"+a).style({width:"100%",height:(Mo.document.clientHeight-32)+"px",left:"-5px",top:"-3px"})},find:function(a){if(!Mo.store.account||Mo.store.model=="classic"){return false}Mo("iframe").each(function(){if(this.contentWindow==a){var b=this;while(b=b.parentNode){if(b.getAttribute("data-dialog")=="dialog"){Mo(b).style({zIndex:(Mo.store.zIndex+=1)}).show();break}}return}})},badge:function(b,a){if(Mo("#quick_"+b+" em").size()==0){Mo("#quick_"+b).create("em",{innerHTML:"0",className:"badge"},true).hide()}if(a){Mo("#quick_"+b+" em").html(a).show()}else{Mo("#quick_"+b+" em").hide()}}},Command:{history:null,listener:function(){var e=location.hash.substring(1);if(e&&e!=Serv.Command.history){Serv.Command.history=e;var d=e.split("&");var c={},f,b=0,a=d.length;for(;b<a;b++){f=d[b].split("=");c[f[0]]=decodeURIComponent(f[1])}Serv.Command.analytic(c)}},analytic:function(data){switch(data.command){case"launch":var parm=(data.content.substring(data.content.indexOf("module/"))).split("/");if(Mo.store.module[parm[1]]){Serv.Module.open(parm[1],Mo.store.module[parm[1]]["name"],"",parm[2])}break;case"module":var parm=Mo.String(data.content).eval();Serv.Module.open(parm.appid,Mo.store.module[parm.appid]["name"],"","");break}}},Notification:{permission:function(a){window.webkitNotifications.requestPermission(a)},show:function(b,c,a){if(window.webkitNotifications&&window.webkitNotifications.checkPermission()>0){RequestPermission(showNotification)}else{window.webkitNotifications.createNotification(b,c,a).show()}}},Message:function(c){var b=c.data;var a=c.origin;console&&console.log(c)},Tip:function(b,a){if(b){var c=Mo(a).position();if(c.left+55>Serv.prefix.width){c.left-=40;cls="last"}else{cls=""}Mo("#tip").attr({className:cls}).style({left:c.left+"px",top:c.top+"px"}).html(b).show()}else{Mo("#tip").hide()}},Interflow:{setHash:function(b,a){if(Mo.store.model=="classic"){parent.location.hash=b+"="+encodeURIComponent(a)}},setMode:function(b){try{parent.Serv.prefix.editMode=b}catch(a){}return b}},Cloud:{recommend:function(a){Mo("#segment_recommend").attr({outerHTML:Mo.Template("segment_recommend",{recommend:a})})},notified:function(a){if(a){Serv.System.loading(true);switch(a["return"]){case"domain":break;case"secret":break;case"success":if(a.engine.version>Mo.store.version||a.statis.upgrade||a.statis.install||a.recommend.length||a.promotion.length||a.notified.length){Mo("#segment_notified").attr({outerHTML:Mo.Template("segment_notified",a)});Mo("#package_notified button").bind("click",function(){Mo("#package_notified").remove()})}break}}else{Serv.System.loading();Mo.script(Serv.API+"?action=service&execute=notified&callback=Serv.Cloud.notified&rnd="+Math.random())}}}};